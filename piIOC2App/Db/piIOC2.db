#################################################
# ###                                       ### #
# ### Epics database for	            ### #
# ### PI - Pollux	                    ### #
# ###                                       ### #
# ### author: D. Hampai - M. Montis         ### #
# ###                                       ### #
# ### Ref 1.0; 2025-08-27                   ### #
#################################################
#
record(stringin, "$(MOT):model") {
	field(DESC, "Device Version $(axis)")
	field(SCAN, "Passive")
	field(DTYP, "stream")
	field(INP, "@piIOC2.proto getModel($(axis)) $(ASYNPORT)")
	field(PINI, "YES")
}
record(stringin, "$(MOT)_$(card)_$(axis):err") {
        field(DESC, "Get Error $(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(INP, "@piIOC2.proto getError($(axis)) $(ASYNPORT)")
        field(PINI, "YES")
}
#
#	POS
#
record(bo, "$(MOT)_$(card)_$(axis):reqpos") {
	field(DESC, "Request Position $(card)_$(axis)")
	field(FLNK, "$(MOT)_$(card)_$(axis):evalpos")	
        field(PINI, "YES")
}
record(ai, "$(MOT)_$(card)_$(axis):pos") {
        field(DESC, "Get Position $(card)_$(axis)")
	field(EGU, "$(EGU)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(INP, "@piIOC2.proto getPos($(axis)) $(ASYNPORT)")
	field(PREC, "3")
        field(PINI, "NO")
}
record(seq, "$(MOT)_$(card)_$(axis):evalpos") {
	field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
	field(DOL1, "1")
        field(LNK1, "$(MOT)_$(card)_$(axis):pos.PROC")
}
#
#	Status Motor
#
record(bo, "$(MOT)_$(card)_$(axis):reqstatus") {
        field(DESC, "Request Status $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalstatus")
	field(ZNAM, "0")  # Label for state 0
	field(ONAM, "1")  # Label for state 1
        field(PINI, "YES")
}
record(stringin, "$(MOT)_$(card)_$(axis):ori_status") {
        field(DESC, "Get Status $(card)_$(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(INP, "@piIOC2.proto getStatus($(card),$(axis)) $(ASYNPORT)")
        field(PINI, "NO")
	field(FLNK, "$(MOT)_$(card)_$(axis):status")
}
record(stringin, "$(MOT)_$(card)_$(axis):term_status") {
	field(DESC, "Terminator for Motor Status")
	field(VAL, "$(onoff)")
	field(PINI, "YES")
}
record(scalcout, "$(MOT)_$(card)_$(axis):status") {
	field(DESC, "Extract Info On/Off")
	field(INAA, "$(MOT)_$(card)_$(axis):ori_status")
	field(INBB, "$(MOT)_$(card)_$(axis):term_status")
	field(CALC, "AA=BB?1:0")
}
record(seq, "$(MOT)_$(card)_$(axis):evalstatus") {
        field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
        field(DOL1, "1")
        field(LNK1, "$(MOT)_$(card)_$(axis):ori_status.PROC")
}
#
#       ON/OFF Motor
#
record(bo, "$(MOT)_$(card)_$(axis):reqmotor") {
        field(DESC, "Request On/Off Motor $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalmotor")
        field(ZNAM, "0")  # Label for state 0
        field(ONAM, "1")  # Label for state 1
}
record(bo, "$(MOT)_$(card)_$(axis):motor") {
        field(DESC, "On/Off Motor $(card)_$(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(ZNAM, "0")  # Label for state 0
        field(ONAM, "1")  # Label for state 1
        field(OUT, "@piIOC2.proto setStatus($(axis)) $(ASYNPORT)")
        field(PINI, "NO")
}
record(seq, "$(MOT)_$(card)_$(axis):evalmotor") {
        field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
        field(DOL1, "$(MOT)_$(card)_$(axis):reqmotor.VAL")
        field(LNK1, "$(MOT)_$(card)_$(axis):motor")
        field(DO2, "1")
        field(LNK2, "$(MOT)_$(card)_$(axis):motor.PROC")
        field(DLY2, "1")
        field(DO3, "1")
        field(LNK3, "$(MOT)_$(card)_$(axis):err")
        field(DO4, "1")
        field(LNK4, "$(MOT)_$(card)_$(axis):status.PROC")
}
#
#       Status Moving
#
record(bo, "$(MOT)_$(card)_$(axis):reqmoving") {
        field(DESC, "Request Status Moving $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalmoving")
        field(ZNAM, "0")  # Label for state 0
        field(ONAM, "1")  # Label for state 1
}
record(stringin, "$(MOT)_$(card)_$(axis):ori_moving") {
	field(DESC, "Get Status Moving $(card)_$(axis)")
	field(SCAN, "Passive")
	field(DTYP, "stream")
	field(INP, "@piIOC2.proto getMoving($(card),$(axis)) $(ASYNPORT)")
	field(PINI, "NO")
	field(FLNK, "$(MOT)_$(card)_$(axis):moving")
}
record(stringin, "$(MOT)_$(card)_$(axis):term_moving") {
	field(DESC, "Terminator for Motor Moving")
	field(VAL, "$(ready)")
	field(PINI, "YES")
}
record(scalcout, "$(MOT)_$(card)_$(axis):moving") {
	field(DESC, "Extract Moving")
	field(INAA, "$(MOT)_$(card)_$(axis):ori_moving")
	field(INBB, "$(MOT)_$(card)_$(axis):term_moving")
	field(CALC, "AA=BB?1:0")
}
record(seq, "$(MOT)_$(card)_$(axis):evalmoving") {
	field(DO0, "1")
	field(LNK0, "$(MOT)_$(card)_$(axis):err")
	field(DOL1, "1")
	field(LNK1, "$(MOT)_$(card)_$(axis):ori_moving.PROC")
}
#
#	MOVE ABSOLUTE
#
record(ao, "$(MOT)_$(card)_$(axis):setma") {
	field(DESC, "Set Move Absolute $(card)_$(axis)")
	field(FLNK, "$(MOT)_$(card)_$(axis):evalma")
	field(PINI, "NO")
}
record(ao, "$(MOT)_$(card)_$(axis):ma") {
	field(DESC, "Move Absolute $(card)_$(axis)")
	field(SCAN, "Passive")
        field(DTYP, "stream")
        field(OUT, "@piIOC2.proto setMovAbs($(axis)) $(ASYNPORT)")
        field(PINI, "NO")
}
record(seq,"$(MOT)_$(card)_$(axis):evalma") {
	field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
	field(DOL1, "$(MOT)_$(card)_$(axis):setma.VAL")
        field(LNK1, "$(MOT)_$(card)_$(axis):ma")
	field(DO2, "1")
        field(LNK2, "$(MOT)_$(card)_$(axis):ma.PROC")
	field(DLY2, "1")
	field(DO3, "1")
        field(LNK3, "$(MOT)_$(card)_$(axis):err")
	field(DO4, "1")
        field(LNK4, "$(MOT)_$(card)_$(axis):pos.PROC")
}
#
#       MOVE RELATIVE
#
record(ao, "$(MOT)_$(card)_$(axis):setmr") {
        field(DESC, "Set Move Relative $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalmr")
        field(PINI, "NO")
}
record(ao, "$(MOT)_$(card)_$(axis):mr") {
        field(DESC, "Move Relative $(card)_$(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(OUT, "@piIOC2.proto setMovRel($(axis)) $(ASYNPORT)")
        field(PINI, "NO")
}
record(seq,"$(MOT)_$(card)_$(axis):evalmr") {
        field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
        field(DOL1, "$(MOT)_$(card)_$(axis):setmr.VAL")
        field(LNK1, "$(MOT)_$(card)_$(axis):mr")
        field(DO2, "1")
        field(LNK2, "$(MOT)_$(card)_$(axis):mr.PROC")
        field(DLY2, "1")
        field(DO3, "1")
        field(LNK3, "$(MOT)_$(card)_$(axis):err")
        field(DO4, "1")
        field(LNK4, "$(MOT)_$(card)_$(axis):pos.PROC")
}
#
#	Initialization
#
record(bo, "$(MOT)_$(card)_$(axis):reqinit") {
        field(DESC, "Request Initialization $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalinit")
        field(ZNAM, "0")  # Label for state 0
        field(ONAM, "1")  # Label for state 1
}
record(ai, "$(MOT)_$(card)_$(axis):init") {
        field(DESC, "Initialization $(card)_$(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(INP, "@piIOC2.proto setInit($(axis),$(homing)) $(ASYNPORT)")
        field(PINI, "NO")
}
record(seq, "$(MOT)_$(card)_$(axis):evalinit") {
        field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
        field(DOL1, "1")
        field(LNK1, "$(MOT)_$(card)_$(axis):init.PROC")
}
#
#       homing
#
record(bo, "$(MOT)_$(card)_$(axis):reqhome") {
        field(DESC, "Request Homing $(card)_$(axis)")
        field(FLNK, "$(MOT)_$(card)_$(axis):evalhome")
        field(ZNAM, "0")  # Label for state 0
        field(ONAM, "1")  # Label for state 1
}
record(ai, "$(MOT)_$(card)_$(axis):home") {
        field(DESC, "Homing $(card)_$(axis)")
        field(SCAN, "Passive")
        field(DTYP, "stream")
        field(INP, "@piIOC2.proto setInit($(axis),$(homing)) $(ASYNPORT)")
        field(PINI, "NO")
}
record(seq, "$(MOT)_$(card)_$(axis):evalhome") {
        field(DO0, "1")
        field(LNK0, "$(MOT)_$(card)_$(axis):err")
        field(DOL1, "1")
        field(LNK1, "$(MOT)_$(card)_$(axis):home.PROC")
}



